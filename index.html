<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="LvWind,undefined"><meta name="copyright" content="LvWind"><title>LvWind Blog</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-69119672-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">LvWind</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://twitter.com/lvwind" target="_blank">Twitter</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">9</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">2</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">4</span></a></div></div></div><nav class="no-bg" id="nav" style="background-image: url(true)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">LvWind Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">LvWind Blog</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item"><a class="article-title" href="/android-o-broadcast/">Android O 对隐式广播的限制以及对策</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-08-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Android/">Android</a></span><div class="content"><p>Android O 应该快要发布正式版了，和 N 一样又是一个用户乍一看在表面上没什么改变的版本，但其实对安全、隐私和规范应用行为做了很多<a href="https://developer.android.com/preview/behavior-changes.html" target="_blank" rel="external">改变</a>。</p>
<p>改变中很重要的一部分就是后台执行限制，其中就有对广播(Broadcast)的<a href="https://developer.android.com/preview/features/background.html#broadcasts" target="_blank" rel="external">限制</a> ，许多隐式广播无法被在 manifest 中静态注册的 BroadcastReceiver 收到。</p>
<p>除了这些由系统发出的隐式广播之外，我们在自己应用里定义的广播也无法被静态注册的 BroadcastReceiver 收到了。<br>以下是几个解决方案：</p>
<h3 id="1-动态注册-BroadcastReceiver"><a href="#1-动态注册-BroadcastReceiver" class="headerlink" title="1.动态注册 BroadcastReceiver"></a>1.动态注册 BroadcastReceiver</h3><p>因为 <code>registerReceiver()</code> 方法只能从一个运行的进程里调用，也就是说你需要一个正在运行的 Activity 或者一个后台 Service ，这样的方法虽然万用但是这个进程终究会被  kill 导致广播收不到。</p>
<h3 id="2-JobScheduler"><a href="#2-JobScheduler" class="headerlink" title="2.JobScheduler"></a>2.JobScheduler</h3><p>官方推荐使用 JobScheduler 代替原来用隐式广播实现的「当某条件达成时发生广播完成某事」的「周期性」功能，并没有广播那么灵活。</p>
<h3 id="3-改为显式广播"><a href="#3-改为显式广播" class="headerlink" title="3.改为显式广播"></a>3.改为显式广播</h3><p>如果广播只是 App 自己发自己收，那么改为显式广播是最简单的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">intent.action = <span class="string">"com.example.test.CLOSE”;</span></span><br><span class="line"><span class="string">intent.setPackage(getPackageName()); //指定包名</span></span><br><span class="line"><span class="string">context.sendBroadcast(intent);</span></span><br></pre></td></tr></table></figure>
<p>但是如果要发给其他 App 接收，而且不知道他们的包名的情况下，该怎么做的。<br>通过pm把所有隐式注册了这个自定义广播的 App列出来，然后转成显式调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent();    </span><br><span class="line">intent.setAction(<span class="string">"com.example.test.CLOSE"</span>);    </span><br><span class="line">sendImplicitBroadcast(context, intent);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendImplicitBroadcast</span><span class="params">(Context context, Intent i)</span> </span>&#123;        </span><br><span class="line">    PackageManager pm = context.getPackageManager();       </span><br><span class="line">    List&amp;lt;ResolveInfo&amp;gt; matches = pm.queryBroadcastReceivers(i, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (ResolveInfo resolveInfo : matches) &#123;            </span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(i);            </span><br><span class="line">        intent.setPackage(resolveInfo.activityInfo.applicationInfo.packageName);            </span><br><span class="line">        intent.setAction(<span class="string">"com.example.test.CLOSE"</span>);            </span><br><span class="line">        context.sendBroadcast(intent);        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&nbsp;</p>
<p>参考：<a href="https://commonsware.com/blog/2017/04/11/android-o-implicit-broadcast-ban.html" target="_blank" rel="external">https://commonsware.com/blog/2017/04/11/android-o-implicit-broadcast-ban.html</a></p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/try-cordova-phonegap/">尝试 Cordova/PhoneGap</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-02-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Android/">Android</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Android/瞎折腾/">瞎折腾</a></span><div class="content"><p>之前接触了一个 hybrid app项目，了解了下几个跨平台框架，也就放在一边没仔细研究，不过接下来可能真的会用到了，先耍起来吧。</p>
<p>Cordova 和 PhoneGap 这两个词几乎是成双成对出现，他们名字的<a href="https://en.wikipedia.org/wiki/Apache_Cordova#History" target="_blank" rel="external">由来和历史</a>在 Wikipedia 写得很清楚了。现在两者的关系有点类似 Chromium 和 Chrome 的关系。目前看来 Adobe 手里的 PhoneGap 只比 Cordova 多了一些额外的商用组件，比如在线打包平台 PhoneGap Build。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>首先 Cordova/PhoneGap 依赖 nodejs<br><code>brew install node</code><br>安装 cordova<br><code>npm install -g cordova</code></p>
<p>创建项目<br><code>cordova create test_cordova com.lvwind.cordova CordovaTest</code><br>*如果提示<code>env: node: No such file or directory</code>的话运行：<br><code>ln -s /usr/bin/nodejs /usr/bin/node</code> <a href="https://github.com/nodejs/node-v0.x-archive/issues/3911#issuecomment-8956154" target="_blank" rel="external">原因</a></p>
<p>添加平台<br><code>cordova platform add android</code></p>
<p>直接编译<br><code>cordova build</code><br>*初次编译会同步从 maven 下载 gradle 组件，会花费比较长的时间<br>build完成后，在<code>/test_cordova/platforms/android/build/outputs/apk</code>下生成一个 debug key 签名的 apk。</p>
<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>Android 平台添加完毕后<code>/test_cordova/platforms/android</code>目录可以作为一个标准 Android 项目从 Android Studio 中打开并调试。</p>
<p><a href="http://blog.lvwind.com/wp-content/uploads/2016/02/crodova_project_in_android_studio.jpg"><img src="http://blog.lvwind.com/wp-content/uploads/2016/02/crodova_project_in_android_studio.jpg" alt="crodova_project_in_android_studio"></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>待续</p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/google-play-service-8-4-0-upgrade-error/">Google Play Service 8.4.0 升级问题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-01-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Android/">Android</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Android/瞎折腾/">瞎折腾</a></span><div class="content"><p>前几天看到项目 build.gradle 里的 Google Play Service 8.3.0 有提示可以升级到8.4.0版本</p>
<p><a href="http://blog.lvwind.com/wp-content/uploads/2016/01/before_update.png"><img src="http://blog.lvwind.com/wp-content/uploads/2016/01/before_update.png" alt="before_update"></a></p>
<p>强迫症看着这波浪线浑身难受就顺手改了下引用版本号，gradle 编译完成后报错，看起来自相矛盾的样子。</p>
<p><a href="http://blog.lvwind.com/wp-content/uploads/2016/01/after_update.png"><img src="http://blog.lvwind.com/wp-content/uploads/2016/01/after_update.png" alt="after_update"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please fix the version conflict either by updating the version of the google-services plugin (information about the latest version is available at https://bintray.com/android/android-tools/com.google.gms.google-services/) or updating the version of com.google.android.gms to 8.3.0.</span><br></pre></td></tr></table></figure>
<p><span class="s2">在 Google Service 官方的 sample 中用了<a href="https://github.com/googlesamples/google-services/commit/8a9ef69f50a9aefeba3fb95880f815382ed56b67" target="_blank" rel="external"><span class="s3">这样的方法</span></a>，把原来写在 </span><span class="s4">build.gradle </span><span class="s2">文件头部的</span></p>
<p><code>apply plugin: &#39;com.google.gms.google-services&#39;</code></p>
<p><span class="s2">放到文件底部。而<a href="https://developers.google.com/android/guides/setup" target="_blank" rel="external"><span class="s3">文档</span></a>里根本没有提起，对这字母表公司好感度越来越低了。</span></p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/update-dell-inspiron-display-drive/">强制更新戴Dell Inspiron双显卡驱动</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2012-07-18</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/瞎折腾/">瞎折腾</a></span><div class="content"><p>去年六月份买的 Dell Inspiron N4110，看中的就是能在 Intel HD 3000 和 AMD HD6630M 之间随意切换的双显卡，之后经常有莫名其妙蓝屏的问题，我也没怎么在意，这是Windows经常有的问题(?)。上学期写作业经常用 C-free 敲代码，十次编译有六次蓝屏，没办法只好装上臃肿的 Visual Studio 2010，也没去深究。后来有次在家用HDMI连电视，用Windows的“扩展”方式双屏显示，上bilibili看动画，结果就卡死了有时候甚至会蓝屏(又来了)，实验了好多次都是这样。</p>
<p>分析 mini dump，确定是 igdpmd32.sys 导致，这个是 ATI(AMD) 显卡驱动，Google了一下发现<a href="http://answers.microsoft.com/zh-hans/windows/forum/windows_7-system/%E7%B3%BB%E7%BB%9F%E6%9C%80%E8%BF%91%E6%80%BB/b750b1b0-90a9-477e-8ff1-dbeedf11788a?msgId=f9d55615-e553-4885-acfa-17efc01df8d2" target="_blank" rel="external">这还不是个别现象</a>，按照微软社区里的说法，把 ATI 的驱动和 Intel 的驱动都更新到最新版就行了。去Dell的驱动页面，只有2011/6/28发布的驱动 <a href="http://www.dell.com/support/drivers/cn/zh/cndhs1/DriverDetails/DriverFileFormats?DriverId=3DDX9&amp;FileId=2731103635&amp;productCode=inspiron-14r-n4110&amp;urlProductCode=False" target="_blank" rel="external">R306735.exe</a>，然后Intel下载了最新版 Intel GMA 3000 驱动，安装时显示“此系统不符合安装该软件的最低要求”。出现这个错误提示是因为Dell自己封装的驱动是他们自己签名的，只能等Dell解决这个问题,这怎么能忍！然后我就开始尝试手动更新两块显卡驱动。</p>
<h3 id="尝试一：只用-AMD-HD6630M"><a href="#尝试一：只用-AMD-HD6630M" class="headerlink" title="尝试一：只用 AMD HD6630M"></a>尝试一：只用 AMD HD6630M</h3><p>把驱动全删了，直接装 AMD CCC 12.6，看似一切正常，重启后设备管理器里是两个感叹号。失败。</p>
<h3 id="尝试二：只用-Intel-HD-3000"><a href="#尝试二：只用-Intel-HD-3000" class="headerlink" title="尝试二：只用 Intel HD 3000"></a>尝试二：只用 Intel HD 3000</h3><p>同样把驱动全删了，直接装最新版 Intel GMA 152612，重启，设备管理器找到 HD3000，AMD HD6630M 上一个感叹号(这当然的吗)。就这样用了几天，刷刷推看看动画都没什么问题，只是那会儿我还在玩 Diablo 3 ，HD3000 的帧率实在是。。。算了不吐槽了，总之没独显还是不行。</p>
<h3 id="尝试三：修改-Dell-官方驱动包"><a href="#尝试三：修改-Dell-官方驱动包" class="headerlink" title="尝试三：修改 Dell 官方驱动包"></a>尝试三：修改 Dell 官方驱动包</h3><p>打开 R306735 看了下，里面是有 Intel 和 AMD 驱动的整合包，Google了下，找到一篇<a href="http://blog.zol.com.cn/2875/article_2874290.html" title="Y460/Y560系列笔记本安装10.7版AMD独显驱动和Intel集显驱动并实现双显卡快速切换" target="_blank" rel="external">《Y460/Y560系列笔记本安装10.7版AMD独显驱动和Intel集显驱动并实现双显卡快速切换》</a>，然后按照这个终于是折腾好显卡驱动了，以下是方法。</p></div><a class="more" href="/update-dell-inspiron-display-drive/#more">Read more</a><hr></div><div class="recent-post-item"><a class="article-title" href="/notitle/">无题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2012-07-17</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/吐槽成风/">吐槽成风</a></span><div class="content"><p>今天扫Google Reader的时候，看到<a href="https://twitter.com/wzyboy" target="_blank" rel="external">@wzyboy</a>的博客更新了，本站<a href="https://wzyboy.im/post/799.html#ch5" title="Apache + WordPress + SSL 完全指南" target="_blank" rel="external">不幸中枪</a>。知错要改嘛，打算把这个高危警告修复掉，打开自己博客，发现距离上次更新一年多了，都长草了。。</p>
<p>小修小补是很快就弄好了，然后想登录后台看看，结果密码忘了(什么烂记性)，重置掉密码后总算是进来了，看到有几十条被Akismet屏蔽的spam，真是长草了。。<br></div><a class="more" href="/notitle/#more">Read more</a><hr></div><div class="recent-post-item"><a class="article-title" href="/shai-device/">晒机</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2011-02-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/吐槽成风/">吐槽成风</a></span><div class="content"><p>总是看见别人晒机吧，我也晒一下，只是过去晒的机都<a href="http://acfunwiki.org/index.php/%E8%BF%87%E5%8E%BBOOO%E7%9A%84%E6%96%B9%E5%BC%8F%E5%BC%B1%E7%88%86%E4%BA%86" target="_blank" rel="external">弱爆了</a>，看我的</p>
<p><a href="http://picplz.com/user/lvwind/pic/44nt/" target="_blank" rel="external"><img src="https://blog.lvwind.com/wp-content/uploads/2011/02/calculator-1024x768.jpg" alt="" title="calculator"></a></p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/search-spider-https/">让搜索引擎抓到https加密站点</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2011-01-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/瞎折腾/">瞎折腾</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/https/">https</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/wordpress/">wordpress</a></span><div class="content"><p>我的博客是强制使用https加密链接的，为什么呢？因为我不想自己写完东西还自我审察一边，比如把“敏感词”写成“敏<em>|感</em>|词”。</p>
<p>但是这样也带来了一些问题，除google以外的搜索引擎全都不收录了。然后找到了一个挺不错的方法，把蜘蛛的user-agent重定向到http &lt;<a href="https://www.deleak.com/blog/2010/06/15/spider-and-https/" target="_blank" rel="external">link</a>&gt;</p>
<h4 id="先修改-htaccess文件"><a href="#先修改-htaccess文件" class="headerlink" title="先修改.htaccess文件"></a>先修改.htaccess文件</h4><p>判断UA并将搜索引擎定向到http，将一般访客定向到https</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">RewriteEngine On</span><br><span class="line"></span><br><span class="line"># BEGIN Force SSL</span><br><span class="line"></span><br><span class="line">RewriteCond %&#123;HTTPS&#125; !on [NC]</span><br><span class="line">RewriteCond %&#123;HTTP_USER_AGENT&#125; !(baiduspider|googlebot|soso|bing|sogou|yahoo|sohu-search|yodao|robozilla|msnbot) [NC]</span><br><span class="line">RewriteRule (.*) https://%&#123;SERVER_NAME&#125;%&#123;REQUEST_URI&#125; [R=301,NC,L]</span><br><span class="line"></span><br><span class="line"># END Force SSL</span><br></pre></td></tr></table></figure>
<h4 id="添加force-ssl插件"><a href="#添加force-ssl插件" class="headerlink" title="添加force-ssl插件"></a>添加force-ssl插件</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Plugin Name: Force SSL Plugin URI: http://www.almosteffortless.com/wordpress/force-ssl/ Description:  For those will an SSL certificate, this plugin forces an HTTPS connection for security purposes. Version: 1.0 Author: Trevor Turk */</span> <span class="function"><span class="keyword">function</span> <span class="title">force_ssl</span><span class="params">()</span> </span>&#123; <span class="keyword">if</span>($_SERVER[<span class="string">"HTTPS"</span>] != <span class="string">"on"</span>) &#123; <span class="keyword">if</span> ($_SERVER[<span class="string">"REQUEST_URI"</span>] != <span class="string">"/blog/feed/"</span>) &#123; <span class="keyword">if</span> (get_naps_bots() ==<span class="keyword">false</span>) &#123; $newurl = <span class="string">"https://"</span> . $_SERVER[<span class="string">"SERVER_NAME"</span>] . $_SERVER[<span class="string">"REQUEST_URI"</span>]; wp_redirect($newurl); <span class="keyword">exit</span>(); &#125; &#125; &#125; &#125; <span class="function"><span class="keyword">function</span> <span class="title">get_naps_bots</span><span class="params">()</span> </span>&#123; $useragent = strtolower($_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]); <span class="keyword">if</span> (strpos($useragent, <span class="string">'baiduspider'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'baiduspider'</span>; &#125; <span class="keyword">if</span> (strpos($useragent, <span class="string">'googlebot'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'googlebot'</span>; &#125; <span class="keyword">if</span> (strpos($useragent, <span class="string">'soso'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'soso'</span>; &#125; <span class="keyword">if</span> (strpos($useragent, <span class="string">'bing'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'bing'</span>; &#125; <span class="keyword">if</span> (strpos($useragent, <span class="string">'yahoo'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'yahoo'</span>; &#125; <span class="keyword">if</span> (strpos($useragent, <span class="string">'sohu-search'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'Sohubot'</span>; &#125; <span class="keyword">if</span> (strpos($useragent, <span class="string">'yodao'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'yodao'</span>; &#125; <span class="keyword">if</span> (strpos($useragent, <span class="string">'robozilla'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'Robozilla'</span>; &#125; <span class="keyword">if</span> (strpos($useragent, <span class="string">'msnbot'</span>) !== <span class="keyword">false</span>)&#123; <span class="keyword">return</span> <span class="string">'msnbot'</span>; &#125; <span class="keyword">return</span> <span class="keyword">false</span>; &#125; add_action(<span class="string">'plugins_loaded'</span>, <span class="string">'force_ssl'</span>);</span><br></pre></td></tr></table></figure>
<p>保存 force-ssl.php 上传到/wp-content/plugins/force-ssl</p>
<h4 id="修改wp-settings-php"><a href="#修改wp-settings-php" class="headerlink" title="修改wp-settings.php"></a>修改wp-settings.php</h4><p>添加:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fix_ssl_siteurl</span><span class="params">($url)</span> </span>&#123;</span><br><span class="line">$scheme = (is_ssl() ? <span class="string">'https'</span> : <span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> === strpos($url, <span class="string">'http'</span>)) &#123;</span><br><span class="line"><span class="keyword">if</span>(is_ssl())</span><br><span class="line"><span class="comment">//search engine no direct</span></span><br><span class="line"><span class="keyword">if</span> ( get_naps_bot !== <span class="keyword">false</span>)&#123;</span><br><span class="line">$url = str_replace(<span class="string">'http://'</span>, <span class="string">"&#123;$scheme&#125;://"</span>, $url); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $url;</span><br><span class="line">&#125;</span><br><span class="line">add_filter(<span class="string">'option_siteurl'</span>, fix_ssl_siteurl);</span><br><span class="line">add_filter(<span class="string">'option_home'</span>, fix_ssl_siteurl);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( !defined(<span class="string">'WP_CONTENT_URL'</span>) )</span><br><span class="line">define( <span class="string">'WP_CONTENT_URL'</span>, get_option(<span class="string">'siteurl'</span>) . <span class="string">'/wp-content'</span>); <span class="comment">// full url - WP_CONTENT_DIR is defined further up</span></span><br><span class="line"><span class="comment">//identify search engint</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_naps_bot</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$useragent = strtolower($_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'baiduspider'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'baiduspider'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'googlebot'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'googlebot'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'soso'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'soso'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'bing'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'bing'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'yahoo'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'yahoo'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'sohu-search'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'Sohubot'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'yodao'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'yodao'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'robozilla'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'Robozilla'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos($useragent, <span class="string">'msnbot'</span>) !== <span class="keyword">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'msnbot'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">$issearchbot = get_naps_bot();</span><br></pre></td></tr></table></figure>
<p>这样就好了，自己改了GoogleBot的UA试了下效果，成功了。</p>
<blockquote>
<p>Mozilla/5.0 (compatible; Googlebot/2.1; +<a href="http://www.google.com/bot.html" target="_blank" rel="external">http://www.google.com/bot.html</a>)</p>
</blockquote>
<p><a href="https://blog.lvwind.com/wp-content/uploads/2011/01/Screenshot.png"><img src="https://blog.lvwind.com/wp-content/uploads/2011/01/Screenshot.png" alt="" title="Screenshot"></a><br>等过两天再看看搜索引擎收录情况吧 :-P</p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/happy-new-year/">Happy New Year</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2010-12-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/吐槽成风/">吐槽成风</a></span><div class="content"><p>好快哦，2011了，祝大家新年快乐 =D</p>
<p>就放个三天假，以下是老师们的新年礼物 &gt;.&lt; (要蛋定..</p>
<p><a href="https://blog.lvwind.com/wp-content/uploads/2010/12/homework.jpg"><img src="https://blog.lvwind.com/wp-content/uploads/2010/12/homework.jpg" alt="" title="homework"></a></p>
<p>我新年的愿望呢很简单也很实际，就是高考能考个好学校咯~ =)</p>
</div><hr></div><div class="recent-post-item"><a class="article-title" href="/restart-from-here/">于此重新开始</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2010-12-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/吐槽成风/">吐槽成风</a></span><div class="content"><p>由于曾经的某此误操作，原来博客[lvwind.net]的数据已不复存在了，那之后也没什么心情再去折腾，然后一直到这几天才决定重新开一个，记录糟糕的生活。</p>
<p>=) 特别感谢小吉米(<a href="http://twitter.com/jimmy_xu_wrk" target="_blank" rel="external">@jimmy_xu_wrk</a>)，帮我抢到lvwind.com这枚域名。</p>
<p>Ps1：表情有爱吧，都是gmail聊天表情    B-)<br>Ps2：以前的链接表也丢了，要交换友链的扔过来吧~</p>
<p>over~  (推特后遗症出现了，什么都写不长 =D</p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2010 - 2018 By LvWind</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script><script>'use strict';'serviceWorker'in navigator&&navigator.serviceWorker.register('service-worker.js').then(function(a){a.onupdatefound=function(){var b=a.installing;b.onstatechange=function(){switch(b.state){case'installed':navigator.serviceWorker.controller?console.log('New or updated content is available.'):console.log('Content is now available offline!');break;case'redundant':console.error('The installing service worker became redundant.');}}}}).catch(function(a){console.error('Error during service worker registration:',a)});
</script></body></html>